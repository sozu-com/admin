<div class="container-fluid">
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <p class="p16">{{'leads.CSRBuyerLeads' | translate}}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="form-group"
                *ngIf="admin?.admin_acl['Buyer Lead Management']?.can_read==1 && !this.parameter.assignee_id">
                <div class="d-flex">
                    <div class="autocomplete">
                        <input placeholder="{{'addForm.placeholder.searchCSRBuyer' | translate}}"
                            style="max-width:200px" list="amenities" [(ngModel)]="parameter.keyword"
                            (input)="getCsrListing()" class="form-control" type="text" name="keyword"
                            (focusout)="closeCsrListing()">
                        <div id="myInputautocomplete-list" class="autocomplete-items">
                            <div *ngFor="let item of users" (click)="selectCsrUser(item)">{{item.email}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8 col-12">
            <div class="cust-tabs-2">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link" href="javascript://" [ngClass]="{'active':parameter.flag==1}"
                            (click)="changeFlag(1)">{{'filters.time.thisWeek' | translate}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript://" [ngClass]="{'active':parameter.flag==2}"
                            (click)="changeFlag(2)">{{'filters.time.thisMonth' | translate}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript://" [ngClass]="{'active':parameter.flag==3}"
                            (click)="changeFlag(3)">{{'filters.time.lastMonth' | translate}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript://" [ngClass]="{'active':parameter.flag==4}"
                            (click)="changeFlag(4)">{{'filters.time.lifetime' | translate}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript://" [ngClass]="{'active':parameter.flag==5}"
                            (click)="parameter.flag=5">{{'filters.time.custom.label' | translate}}</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div *ngIf="parameter.flag == 5" class="row">
                <div class="offset-lg-7"></div>
                <div class="col-lg-2 col-md-2 col-sm-5 col-5">
                    <div class="form-group marginB0">
                        <label>{{'filters.time.custom.from' | translate}}:</label>
                        <p-calendar showIcon="true" [locale]="locale" [(ngModel)]="parameter.min" [maxDate]="today"
                            showButtonBar="true" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2040">
                        </p-calendar>
                    </div>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-5 col-5">
                    <div class="form-group marginB0">
                        <label>{{'filters.time.custom.to' | translate}}:</label>
                        <p-calendar showIcon="true" [locale]="locale" [(ngModel)]="parameter.max"
                            [minDate]="parameter.min" [maxDate]="today" showButtonBar="true" [monthNavigator]="true"
                            [yearNavigator]="true" yearRange="2000:2040"></p-calendar>
                    </div>
                </div>
                <div class="col-lg-1 col-md-2 col-sm-2 col-6">
                    <div class="form-group btn-cont">
                        <label class="addMT3">&nbsp;</label>
                        <button class="btn btn-calender" href="javascript://"
                            (click)="getListing(); getCSRDashBoardData();"
                            [disabled]="!parameter.min || !parameter.max">{{'filters.time.custom.applyBtn' |
                            translate}}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="listingResults">
        <div class="row" *ngIf="admin?.admin_acl['Buyer Lead Management']?.can_read==1 && !this.parameter.assignee_id">
            <div class="col-md-2">
                <div class="form-group">
                    <label>{{'filters.location.country' | translate}}</label>
                    <select class="form-control" (change)="onCountryChange($event.target.value)">
                        <option value="0">{{'filters.location.allOption' | translate}}</option>
                        <option *ngFor="let item of location.countries" [value]="item.id">{{item.name}}</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label>{{'filters.location.state' | translate}}</label>
                    <select class="form-control" (change)="onStateChange($event.target.value)">
                        <option value="0">{{'filters.location.allOption' | translate}}</option>
                        <option *ngFor="let item of location.states" [value]="item.id">{{item.name}}</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label>{{'filters.location.city' | translate}}</label>
                    <select class="form-control" (change)="onCityChange($event.target.value)">
                        <option value="0">{{'filters.location.allOption' | translate}}</option>
                        <option *ngFor="let item of location.cities" [value]="item.id">{{item.name}}</option>
                    </select>
                </div>
            </div>

            <div class="col-md-2">
                <div class="form-group">
                    <label>{{'filters.location.locality' | translate}}</label>
                    <select class="form-control" (change)="onLocalityChange($event.target.value)">
                        <option value="0">{{'filters.location.allOption' | translate}}</option>
                        <option *ngFor="let item of location.localities" [value]="item.id">{{item.name}}</option>
                    </select>
                </div>
            </div>

            <div class="col-md-2">
                <div class="form-group btn-cont">
                    <label style="display: block; margin-top: 3px;">&nbsp;</label>
                    <button type="button" (click)="getListing(); getCSRDashBoardData();"
                        class="btn btn-primary-new width100P">{{'filters.location.applyBtn' | translate}}</button>
                </div>
            </div>

            <div class="col-md-2">
                <div class="form-group btn-cont">
                    <label style="display: block; margin-top: 3px;">&nbsp;</label>
                    <button type="button" (click)="resetFilters()"
                        class="btn btn-primary-new width100P">{{'filters.location.resetBtn' | translate}}</button>
                </div>
            </div>
        </div>

        <div *ngIf="selectedUser as item" class="sigle-row-table">
            <table class="table table-striped">
                <tbody>
                    <tr>
                        <td><img class="rounded-circle" [src]="item.image| img:'small'"
                                onerror='this.src="assets/img/default_img.png"' alt="img"></td>
                        <td class="text-left">
                            <span class="name">{{item.name | titlecase}}</span>
                        </td>
                        <td class="text-left">{{item.phone}}</td>
                        <td class="text-left">{{item.email}}</td>
                        <td>
                            <a (click)="removeCsrUser()" href="javascript://" class="icon-block edit-icon">
                                <img src="assets/img/remove-icon.png" alt="remove"
                                    title="{{'table.title.remove' | translate}}" /></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="row">
            <div class="col-lg-8 col-md-12 col-sm-12 col-12">
                <div class="info-box all-leads">
                    <div class="row">
                        <div class="col-md-6 col-sm-6 col-12" [ngClass]="{'active':parameter.count_flag == 1}"
                            (click)="changeCountFlag(1)">
                            <div class="one-row ">
                                <div class="o-block">
                                    <h5>{{'table.th.leads' | translate}}</h5>
                                    <small>{{'table.th.total' | translate}}</small>
                                </div>
                                <div class="o-block">
                                    <a class="view-all" href="javascript://">{{'table.th.viewAll' | translate}}</a>
                                    <h4>{{dash?.lead_total}}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6 col-12" [ngClass]="{'active':parameter.count_flag == 2}"
                            (click)="changeCountFlag(2)">
                            <div class="one-row">
                                <div class="o-block">
                                    <h5>{{'table.th.leads' | translate}}</h5>
                                    <small>{{'table.th.withoutAgent' | translate}}</small>
                                </div>
                                <div class="o-block">
                                    <a class="view-all" href="javascript://">{{'table.th.viewAll' | translate}}</a>
                                    <h4>{{dash?.lead_without_broker}}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="info-box all-leads">
                    <div class="row">
                        <div class="col-md-6 col-sm-6 col-12" [ngClass]="{'active':parameter.count_flag == 3}"
                            (click)="changeCountFlag(3)">
                            <div class="one-row ">
                                <div class="o-block">
                                    <h5>{{'table.th.leads' | translate}}</h5>
                                    <small>{{'table.th.infoFilled' | translate}}</small>
                                </div>
                                <div class="o-block">
                                    <a class="view-all" href="javascript://">{{'table.th.viewAll' | translate}}</a>
                                    <h4>{{dash?.lead_information_filled}}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6 col-12" [ngClass]="{'active':parameter.count_flag == 4}"
                            (click)="changeCountFlag(4)">
                            <div class="one-row">
                                <div class="o-block">
                                    <h5>{{'table.th.leads' | translate}}</h5>
                                    <small>{{'table.th.agentAssigned' | translate}}</small>
                                </div>
                                <div class="o-block">
                                    <a class="view-all" href="javascript://">{{'table.th.viewAll' | translate}}</a>
                                    <h4>{{dash?.lead_broker_assigned}}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-12 col-sm-12 col-12">
                <div class="chat-msg all-leads" style="padding:0px">
                    <div class="padding20" *ngIf="dash?.lead_total == 0">{{'message.error.noRecordFound' | translate}}
                    </div>
                    <ngx-charts-pie-chart [results]="chartView"></ngx-charts-pie-chart>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="spacer40"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 col-md-6 col-6">
                <div class="title-group">
                    <h5>{{'table.th.leads' | translate}}
                        <span *ngIf="parameter.count_flag == 1">({{'table.th.total' | translate}})</span>
                        <span *ngIf="parameter.count_flag == 2">({{'table.th.withoutAgent' | translate}})</span>
                        <span *ngIf="parameter.count_flag == 3">({{'table.th.infoFilled' | translate}})</span>
                        <span *ngIf="parameter.count_flag == 4">({{'table.th.agentAssigned' | translate}})</span>
                    </h5>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-5"
                *ngIf="admin?.admin_acl['Buyer Lead Management']?.can_read==1 && !this.parameter.assignee_id">
                <div class="add-new text-right">
                    <a class="btn" (click)="bulkAssign()" href="javascript://">{{'table.th.bulkReassign' |
                        translate}}</a>
                </div>
            </div>
        </div>
        <div class="white-bg">
            <div class="tabel-section">
                <div class="table-responsive">
                    <table class="table table-striped table-align-left vertical-align-top">
                        <tr>
                            <th *ngIf="admin?.admin_acl['Buyer Lead Management']?.can_read==1 && !this.parameter.assignee_id"
                                style="width:6%">
                                <div class="table-search">
                                    <label>{{'table.th.all' | translate}}</label>
                                    <div>
                                        <label class="cust-check-bx">
                                            <input class="width1" type="checkbox" [(ngModel)]="allSelected"
                                                (click)="selectAll(parameter.is_selected)" name="document">
                                            <span class="checkmark"></span>
                                        </label>
                                    </div>
                                </div>
                            </th>
                            <th style="width:17%">
                                <div class="table-search"><label>{{'table.th.lead_date' | translate}}</label></div>
                            </th>
                            <th style="width:6%">
                                <div class="table-search"><label>{{'table.th.image' | translate}}</label></div>
                            </th>
                            <th style="width:15%">
                                <div class="table-search">
                                    <label>{{'table.th.name' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text" [(ngModel)]="parameter.name"
                                            (keyup.enter)="changeFilter('name',$event.target.value)" name="">
                                        <button *ngIf="parameter.name" (click)="changeFilter('name', parameter.name)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:15%;">
                                <div class="table-search">
                                    <label>{{'table.th.firstSurname' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text"
                                            [(ngModel)]="parameter.first_surname"
                                            (keyup.enter)="changeFilter('first_surname',$event.target.value)" name="">
                                        <button *ngIf="parameter.first_surname"
                                            (click)="changeFilter('first_surname', parameter.first_surname)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:15%;">
                                <div class="table-search">
                                    <label>{{'table.th.secondSurname' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text"
                                            [(ngModel)]="parameter.second_surname"
                                            (keyup.enter)="changeFilter('second_surname',$event.target.value)" name="">
                                        <button *ngIf="parameter.second_surname"
                                            (click)="changeFilter('second_surname', parameter.second_surname)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:19%; text-align:left;">
                                <div class="table-search">
                                    <label>{{'table.th.contactNumber' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text" [(ngModel)]="parameter.phone"
                                            (keyup.enter)="changeFilter('phone',$event.target.value)" name="">
                                        <button *ngIf="parameter.phone"
                                            (click)="changeFilter('phone', parameter.phone)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:20%">
                                <div class="table-search">
                                    <label>{{'table.th.emailAddress' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text" [(ngModel)]="parameter.email"
                                            (keyup.enter)="changeFilter('email',$event.target.value)" name="">
                                        <button *ngIf="parameter.email"
                                            (click)="changeFilter('email', parameter.email)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:24%">
                                <div class="table-search">
                                    <label>{{'table.th.project' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text"
                                            [(ngModel)]="parameter.project_text"
                                            (keyup.enter)="changeFilter('project_text',$event.target.value)"
                                            name="project_text">
                                        <button *ngIf="parameter.project_text"
                                            (click)="changeFilter('project_text', parameter.project_text)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:15%">
                                <div class="table-search">
                                    <label>{{'table.th.property' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text"
                                            [(ngModel)]="parameter.property_text"
                                            (keyup.enter)="changeFilter('property_text',$event.target.value)"
                                            name="property_text" style="width:60px;">
                                        <button *ngIf="parameter.property_text"
                                            (click)="changeFilter('property_text', parameter.property_text)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <!-- <th style="width:6%">
                                <div class="table-search">
                                    <label>{{'table.th.propertyFor' | translate}}</label>
                                </div>
                            </th> -->
                            <th style="width:24%">
                                <div class="table-search">
                                    <label>{{'table.th.csrAssignation' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text"
                                            [(ngModel)]="parameter.csr_buyer_text"
                                            (keyup.enter)="changeFilter('csr_buyer_text',$event.target.value)"
                                            name="csr_buyer_text">
                                        <button *ngIf="parameter.csr_buyer_text"
                                            (click)="changeFilter('csr_buyer_text', parameter.csr_buyer_text)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:10%">
                                <div class="table-search">
                                    <label>{{'table.th.status' | translate}}</label>
                                    <div class="searh-3">
                                        <select [(ngModel)]="parameter.status_id"
                                            (change)="changeFilter('status_id', parameter.status_id)" name="status_id">
                                            <option value="">{{'table.th.all' | translate}}</option>
                                            <option *ngFor="let tempStatusName of addChangeStatusNames"
                                                value="{{tempStatusName.id}}">
                                                {{translate.defaultLang == 'en'? tempStatusName.name :
                                                tempStatusName.name_es}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </th>
                            <th style="width:24%">
                                <div class="table-search">
                                    <label>{{'table.th.AgentAsignation' | translate}}</label>
                                    <div class="searh-3">
                                        <input autocomplete="address-level4" type="text"
                                            [(ngModel)]="parameter.agent_text"
                                            (keyup.enter)="changeFilter('agent_text',$event.target.value)"
                                            name="agent_text">
                                        <button *ngIf="parameter.agent_text"
                                            (click)="changeFilter('agent_text', parameter.agent_text)"><i
                                                class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </th>
                            <th style="width:10%">
                                <div class="table-search">
                                    <label>{{'table.th.statusHistory' | translate}}</label>
                                </div>
                            </th>
                            <th style="width:10%">
                                <div class="table-search">
                                    <label>{{'table.th.actions.label' | translate}}</label>
                                </div>
                            </th>
                        </tr>
                        <tr class="cursor-pointer" title="{{'table.title.clickToViewDetails' | translate}}"
                            *ngFor="let item of items| paginate: { itemsPerPage: parameter.itemsPerPage, currentPage: parameter.page, totalItems: parameter.total }">
                            <!-- routerLink="/dashboard/leads/csr-buyers/{{item.id}}" -->
                            <td *ngIf="admin?.admin_acl['Buyer Lead Management']?.can_read==1 && !this.parameter.assignee_id"
                                (click)="$event.stopPropagation()">
                                <label class="cust-check-bx">
                                    <input type="checkbox" [(ngModel)]="item.selected" name="document">
                                    <span class="checkmark"></span>
                                </label>
                                <!-- <i class="fa" [ngClass]="item.selected?'fa-check-square-o':'fa-square-o'" (click)="item.selected = !item.selected" aria-hidden="true"></i> -->
                            </td>
                            <td>
                                <span class="name" *ngIf="item.updated_at">{{item.updated_at | date}}</span>
                            </td>
                            <td class="text-left" (click)="viewLeadDetails(item.id, item)">
                                <img [src]="item?.user?.image ? item?.user?.image : item?.image| img:'small'"
                                    class="rounded-circle" onerror='src="assets/img/default_img.png"' alt="img">
                            </td>
                            <td class="text-left">
                                <span *ngIf="item.name" class="name"
                                    (click)="viewLeadDetails(item.id, item)">{{item?.user && item?.user?.name ?
                                    (item?.user?.name | titlecase) : (item?.name | titlecase)}}</span>
                                <span class="name" *ngIf="!item.name">{{'table.tr.td.NA' | translate}}</span>
                            </td>
                            <td class="text-left" (click)="viewLeadDetails(item.id, item)">
                                <span class="name">{{item?.user && item?.user?.first_surname ? item?.user?.first_surname
                                    : (item?.first_surname ) ? (item?.first_surname |
                                    titlecase) : ('table.tr.td.NA' | translate)}}</span>
                            </td>
                            <td class="text-left" (click)="viewLeadDetails(item.id, item)">
                                <span class="name">{{item?.user && item?.user?.second_surname ?
                                    item?.user?.second_surname : item?.second_surname? (item?.second_surname |
                                    titlecase):('table.tr.td.NA' | translate)}}</span>
                            </td>
                            <td class="text-left" *ngIf="item?.phone">
                                {{item?.dial_code ? item?.dial_code : constant.dial_code}}-{{item?.user?.phone ?
                                item?.user?.phone : item.phone}}</td>
                            <td class="text-left" *ngIf="!item.phone">{{'table.tr.td.NA' | translate}}</td>
                            <td class="text-left" *ngIf="item.email">{{item?.user?.email ? item?.user?.email :
                                item.email}}</td>
                            <td class="text-left" *ngIf="!item.email">{{'table.tr.td.NA' | translate}}</td>
                            <td class="text-left">{{item?.building?.name ? item?.building?.name : ('table.tr.td.NA' |
                                translate)}}</td>
                            <!-- <td class="text-left" title="{{'table.title.CSRBuyer' | translate}}">{{item?.admin?.name ?
                                item?.admin?.name : ('table.tr.td.NA' | translate)}}</td> -->
                            <td class="text-left">{{item?.property?.name ? item?.property?.name : ('table.tr.td.NA' |
                                translate)}}</td>

                            <td class="text-left green-color cursor-pointer" (click)="openModel('CSR', item)">
                                <span>{{item?.admin ? item?.admin?.name : ('leads.linkCSRBuyer' | translate)}}</span>
                            </td>
                            <td class="text-left green-color cursor-pointer" (click)="openAddChangeStatusModel(item)">
                                <span>
                                    {{item?.status && translate.defaultLang == 'en' ?
                                    item.status.status_details.name.slice(0, 11) :
                                    item?.status && translate.defaultLang != 'en' ?
                                    item.status.status_details.name_es.slice(0, 11) :
                                    ('table.tr.td.add' | translate)}}
                                </span>
                            </td>
                            <td class="text-left green-color cursor-pointer" (click)="openModel('', item)">
                                <span>{{item?.broker ? item?.broker?.name : ('leads.linkAgent' | translate)}}</span>
                            </td>
                            <td class="text-left green-color cursor-pointer" (click)="openStatusHistoryModel(item)">
                                <span>{{item.admin_id || item?.status ? ('table.tr.td.view' | translate) :
                                    ('table.tr.td.NA' |
                                    translate)}}</span>
                            </td>
                            <td class="text-left" style="display: inline-flex" (click)="$event.stopPropagation()">
                                <button class="action-icon" (click)="this.sendMail(item)" [disabled]="item.user_id"
                                    title="{{'table.title.confirmEmail' | translate}}">
                                    <i class="fa fa-map-marker" aria-hidden="true"
                                        style="font-size: 166%;color: lightgray;" *ngIf="item.user_id "></i>
                                    <i class="fa fa-map-marker" aria-hidden="true" style="font-size: 166%;color: black;"
                                        *ngIf="!item.user_id"></i>
                                </button>
                                <button [disabled]="admin?.admin_acl['Buyer Management']?.can_delete==0"
                                    (click)="deletePopup(item)" class="action-icon"
                                    title="{{'table.title.delete' | translate}}"><img src="assets/img/ic_delete.png"
                                        alt="img"></button>
                            </td>
                        </tr>
                    </table>
                    <div class="padding20 center" *ngIf="parameter.noResultFound">
                        <img src="assets/img/404-error.png" alt="Not found">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="btn-cont marginT15" *ngIf="parameter.total">
        <div class="row">
            <div class="col-6">
                <div class="title-group">
                    <p>{{'table.pagination.showing' | translate}} {{items?.length}} {{'table.pagination.outof' |
                        translate}} {{parameter.total}}</p>
                </div>
            </div>
            <div class="col-6 text-right">
                <pagination-controls class="my-pagination" (pageChange)="getPage($event)"></pagination-controls>
            </div>
        </div>
    </div>
</div>

<!-- Assignment model -->
<a data-toggle="modal" data-target="#assign-model" #openAssignModel style="display: none;"></a>
<div class="modal" id="assign-model">
    <div class="modal-dialog ">
        <div class="modal-content notary-avail">
            <div class="modal-header popup-header">
                <h4 class="modal-title">{{'leads.reAssignTo' | translate}}</h4>
                <button type="button" class="close" data-dismiss="modal" #closeAssignModel>&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8 col-6">
                        <input title="{{'table.title.clickEnterForSearch' | translate}}" style="max-width:200px"
                            list="amenities" [(ngModel)]="assign.keyword" (keyup.enter)="getAssignListing()"
                            class="form-control" type="text" name="keyword"
                            placeholder="{{'addForm.placeholder.search' | translate}}">
                    </div>
                    <div class="col-md-4 col-5 btn-cont">
                        <a class="btn btn-primary pull-right" href="javascript://"
                            (click)="openFor= 'CSR';assignBuyerAgent(null)">{{'leads.assign' | translate}}</a>
                    </div>
                </div>
                <div class="spacer40"></div>
                <div *ngIf="showSearchText">
                    <p class="show-not-found">{{'leads.searchCSRBuyer' | translate}}</p>
                </div>
                <div class="modal-table-data" malihu-scrollbar [scrollbarOptions]="scrollbarOptions">
                    <table class="table">
                        <tr *ngFor="let item of assign.items">
                            <td *ngIf="item.is_blocked!=1">
                                <div class="n-avail-profile">
                                    <img [src]="item.image| img:'small'" onerror='src="assets/img/default_img.png"'
                                        alt="img">
                                    <div class="n-avail-info">
                                        <p class="p12">{{item.name | titlecase}}</p>
                                        <p class="p10">{{'leads.phone' | translate}} :
                                            {{item.dial_code ? item.dial_code :
                                            constant.dial_code}}-{{item.phone.trim()}}
                                        </p>
                                    </div>
                                </div>
                            </td>
                            <td *ngIf="item.is_blocked!=1">
                                <label class="cust-check-bx float-right">
                                    <input type="radio" name="notary_id"
                                        (click)="assignItem = item; selected_lead = item"
                                        [checked]="item?.id == assignItem?.id">
                                    <span class="checkmark"></span>
                                </label>
                            </td>
                        </tr>
                        <tr *ngIf="assign?.items?.length==0">
                            <p class="show-not-found">{{'leads.noCSRBuyer' | translate}}</p>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Assignment model -->
<a data-toggle="modal" data-target="#new-assign-model" #openNewAssignModel style="display: none;"></a>
<div class="modal" id="new-assign-model">
    <div class="modal-dialog ">
        <div class="modal-content notary-avail">
            <div class="modal-header popup-header">
                <h4 class="modal-title">{{openFor == 'CSR'? ('leads.linkCSRBuyer'| translate) : ('leads.linkAgent' |
                    translate)}}</h4>
                <button type="button" class="close" data-dismiss="modal" #closeNewAssignModel>&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-10 col-10">
                        <label style="font-weight: bold;font-size: 15px;">Search Name</label>
                        <input title="{{'table.title.clickEnterForSearch' | translate}}"
                            style="max-width: 264px;height: 55px;" list="amenities" [(ngModel)]="assign.keyword"
                            (keyup.enter)="getSearchAssign()" class="form-control" type="text" name="keyword"
                            placeholder="{{'addForm.placeholder.search' | translate}}">
                    </div>
                </div>
                <div class="spacer40"></div>
                <!-- <div *ngIf="showSearchText">
                    <p class="show-not-found">{{'leads.searchCSRBuyer' | translate}}</p>
                </div> -->
                <div class="modal-table-data" malihu-scrollbar [scrollbarOptions]="scrollbarOptions">
                    <table class="table">
                        <tr *ngFor="let item of assign.items; let i=index">
                            <td *ngIf="item.is_blocked!=1">
                                <div class="n-avail-profile">
                                    <img [src]="item.image| img:'small'" onerror='src="assets/img/default_img.png"'
                                        alt="img">
                                    <div class="n-avail-info">
                                        <p class="p12">{{item.name | titlecase}}</p>
                                        <p class="p10">{{'leads.phone' | translate}} :
                                            {{item.dial_code ? item.dial_code :
                                            constant.dial_code}}-{{item.phone.trim()}}
                                        </p>
                                    </div>
                                </div>
                            </td>
                            <td *ngIf="item.is_blocked!=1">
                                <!-- <label class="cust-check-bx float-right">
                                    <input type="radio" name="notary_id" (click)="assignItem = item"
                                        [checked]="item?.id == assignItem?.id">
                                    <span class="checkmark"></span>
                                </label> -->
                                <button *ngIf="selected_lead?.admin_id!=item.id"
                                    (click)="assignItem = item; assignBuyerAgent(null)" class="action-icon"
                                    title="{{'table.title.linkAgent' | translate}}">
                                    <img src="assets/img/green-icon.png" alt="img"></button>

                                <button *ngIf="selected_lead?.admin_id==item.id"
                                    (click)="assignItem = item; assignBuyerAgent(null)" class="action-icon"
                                    title="{{'table.title.unlinkAgent' | translate}}">
                                    <img src="assets/img/ic_disapprove.png" alt="img"></button>
                            </td>
                        </tr>
                        <tr *ngIf="assign?.items?.length==0">
                            <p class="show-not-found">{{'leads.noCSRBuyer' | translate}}</p>
                        </tr>
                    </table>
                </div>
                <!-- <div class="row">
                    <div class="col-md-6 col-5 btn-cont">
                        <a class="btn btn-primary pull-right" style="width: 180px;padding: 12px 15px;"
                            href="javascript://" (click)="assignBuyerAgent(null)">{{'leads.assign' | translate}}</a>
                    </div>
                    <div class="col-md-6 col-5 btn-cont">
                        <a class="btn btn-primary pull-right"
                            style="width: 180px;background-color: #fe0002;padding: 12px 15px;" href="javascript://"
                            data-dismiss="modal" #closeNewAssignModel (click)="closeModal()">{{'advanceSearch.cancel' |
                            translate}}</a>
                    </div>
                </div> -->
            </div>
        </div>
    </div>
</div>

<a data-toggle="modal" data-target="#link-broker-model" #linkBrokerModal style="display: none;"></a>
<div class="modal" id="link-broker-model">
    <div class="modal-dialog ">
        <div class="modal-content notary-avail">
            <div class="modal-header popup-header">
                <h4 class="modal-title">{{'leads.linkAgent' | translate}}</h4>
                <button type="button" class="close" #closeBrokerModal data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">

                <!-- <p class="modal-title" *ngIf="property?.external_broker?.id"
            [ngClass]="{'green-color cursor-pointer': property?.external_broker?.name}" (click)="agentTab(property?.external_broker, true)">
                  {{'viewProperty.currentlyLinkedToAgent' | translate}} - 
                  <b>{{property?.external_broker?.name}}&nbsp;
                  {{property?.external_broker?.first_surname}}&nbsp;
                  {{property?.external_broker?.second_surname}}</b></p> -->
                <br />
                <div class="row">
                    <div class="col-md-8 col-6">
                        <input style="max-width:200px" (keyup.enter)="getSearchAssign()" [(ngModel)]="assign.keyword"
                            class="form-control" type="text" name="keyword"
                            placeholder="{{'addForm.placeholder.search' | translate}}">
                    </div>
                    <div class="col-md-4 col-5 btn-cont">
                        <a class="btn btn-primary pull-right" href="javascript://"
                            (click)="getSearchAssign()">{{'viewProperty.search' | translate}}</a>
                    </div>
                </div>

                <div class="spacer40"></div>
                <div class="modal-table-data" malihu-scrollbar [scrollbarOptions]="scrollbarOptions">
                    <table class="table">
                        <tr *ngFor="let item of assign.items">
                            <td>
                                <div class="n-avail-profile">
                                    <img *ngIf="item?.image" onerror='src="assets/img/default_img.png"' alt="img"
                                        [defaultImage]="item?.image| img:'thumb'" [lazyLoad]="item?.image">
                                    <img *ngIf="!item?.image" src="assets/img/default_img.png" alt="img">

                                    <div class="n-avail-info">
                                        <p class="p12">{{item?.name | titlecase}}</p>
                                        <p class="p10 marginB0">{{item?.is_external_agent ? 'OUTSIDE AGENT' : 'IN-HOUSE
                                            AGENT'}}
                                        </p>
                                        <p class="p10">{{'viewProperty.phone' | translate}} : {{item?.dial_code ?
                                            item?.dial_code
                                            : constant.dial_code}}-{{item?.phone}}</p>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <button *ngIf="selected_lead?.broker_id!=item.id" (click)="assignBuyerAgent(item)"
                                    class="action-icon" title="{{'table.title.linkAgent' | translate}}">
                                    <img src="assets/img/green-icon.png" alt="img"></button>

                                <button *ngIf="selected_lead?.broker_id==item.id" (click)="assignBuyerAgent(item)"
                                    class="action-icon" title="{{'table.title.unlinkAgent' | translate}}">
                                    <img src="assets/img/ic_disapprove.png" alt="img"></button>
                            </td>
                        </tr>
                        <tr *ngIf="assign.items?.length==0">
                            <p class="show-not-found">{{'leads.noInhouseAgent' | translate}}</p>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<a #addChangeStatusModelOpen class="btn-third btn btn-block" data-target="#add-change-status" data-toggle="modal"
    style="display: none;"></a>
<div class="modal" id="add-change-status">
    <div class="modal-dialog">
        <div class="modal-content notary-avail">
            <div class="modal-header popup-header">
                <div class="row" style="width: 100%;">
                    <div class="col-12" style="display: contents;">
                        <h4 class="modal-title">{{'leads.addChangeStatus' | translate}}</h4>
                        <button type="button" class="close" data-dismiss="modal"
                            #addChangeStatusModelClose>&times;</button>
                    </div>
                    <div class="col-12">
                        <span *ngIf="selected_lead?.status"
                            style="font-weight: bold;white-space: pre-line">{{'leads.status' | translate}} -
                            {{selected_lead?.status?.status_details?.name}}</span>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-6">
                        <P style="font-weight: bold;">{{'leads.selectStatus' | translate}}</P>
                    </div>
                </div>
                <div style="padding-left: inherit;" *ngFor="let tempStatusName of addChangeStatusNames; let i=index">
                    <div class="col-md-12 col-6">
                        <span><input type="radio" id="status{i}" name="status" value="{{tempStatusName.id}}"
                                [checked]="tempStatusName.id == selectedAddChangeStatus"
                                (change)="isChecked(tempStatusName)"></span>
                        <label style="font-weight: bold; padding: inherit;font-size: medium;">{{translate.defaultLang ==
                            'en'? tempStatusName.name : tempStatusName.name_es}}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-5 btn-cont">
                        <!-- <a class="btn btn-primary pull-right" style="width: 180px;padding: 12px 15px;"
                            href="javascript://" (click)="this.onClickAddStatus()">{{'leads.addStatus' | translate}}</a> -->
                    </div>
                    <div class="col-md-6 col-5 btn-cont">
                        <a class="btn btn-primary pull-right" style="width: 180px;padding: 12px 15px;"
                            href="javascript://" (click)="onClickAddStatus()">{{'leads.addStatus' | translate}}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<a #viewStatuHistoryModelOpen class="btn-third btn btn-block" data-target="#view-status-history" data-toggle="modal"
    style="display: none;"></a>
<div class="modal" id="view-status-history">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" #viewStatuHistoryModelClose>&times;</button>
            </div>
            <div class="modal-body">
                <h3>{{'leadDetails.leadStatusHistory' | translate}}</h3>
                <hr>
                <div class="scrollbox fav-prop" malihu-scrollbar [scrollbarOptions]="scrollbarOptions">
                    <div class="row">
                        <div class="col-lg-6 col-md-12 col-sm-12 col-12 wn-block"
                            *ngFor="let item of history; let in=index">
                            <div class="circle">
                                <span></span>
                            </div>
                            <p class="time">{{item.assign_from.name}} {{item.assign_from.first_surname || ''}}
                                {{item.assign_from.second_surname || ''}}</p>
                            <pre class="p13"
                                style="margin-bottom: 0px;color: rgba(0,0,0,0.5);font-size: 12px;">{{item.created_at  | chatTime: 'YYYY-MM-DD H:m:s': 2}}</pre>
                            <pre
                                class="p13">{{item.type == 1 ? (('leadDetails.assigned' | translate) + ' ' + (item.assign_to.name + ' ' + item.assign_to.first_surname + ' ' + item.assign_to.second_surname) + ('leadDetails.AsCSRAgent' | translate)) : item.type == 2 ? 
                        (('leadDetails.assigned' | translate) + ' ' + (item.assign_to.name + ' ' + item.assign_to.first_surname + ' ' + item.assign_to.second_surname) + ('leadDetails.AsInhouseAgent' | translate)) : item.type == 3 ? 
                        (('leadDetails.hasUpdateStatusTo' | translate) + ' ' + (lang == 'en' ? item.status_details.name : item.status_details.name_es) + ' ' + ('leadDetails.forCSRAgent' | translate)) : item.type == 4 ? 
                        (('leadDetails.hasUpdateStatusTo' | translate) + ' ' + (lang == 'en' ? item.status_details.name : item.status_details.name_es) + ' ' + ('leadDetails.forInhouseAgent' | translate)) : ''}}</pre>
                        </div>
                        <div class="col-12" style="font-size: 18px;text-align: center;margin-top: 33%;"
                            *ngIf="!history || history.length == 0">
                            <pre>{{'leadDetails.noLeadStatusHistoryAavailable' | translate}}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>