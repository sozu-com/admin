<div class="container-fluid">
<div class="white-bg padding15">
    <div class="row">
        <div class="col-lg-3 col-md-12 col-sm-6 col-12">
            <div class="df-profile">
            <a routerLink="../"><i class="fa fa-angle-left" aria-hidden="true"></i></a>
            
            <img *ngIf="leadData?.user?.image" onerror='src="assets/img/default_img.png"' alt="img"
                    [defaultImage]="leadData?.user?.image| img:'thumb'" [lazyLoad]="leadData?.user?.image">
            <img *ngIf="!leadData?.user?.image" src="assets/img/default_img.png" alt="img">
    
                    <div class="df-info" *ngIf="leadData?.user">
                <p class="p14 text-ellipsis120">{{leadData.user.name | titlecase}}</p>
                <!-- <p class="p12">Status: Open</p> -->
                <p class="p12">
                    {{leadData?.user?.dial_code ? leadData?.user?.dial_code : leadData?.dial_code}}-{{leadData?.user?.phone ? leadData?.user?.phone : leadData?.phone}}
                </p>
            </div>
            </div>
        </div>
        <div class="col-lg-7 col-md-12 col-sm-6 col-12">
            <div class="profile-list">
            <ul>
                <li>
                    <div class="df-info">
                        <p class="p14 marginB0" *ngIf="leadData?.admin">{{leadData.admin.name | titlecase}}</p>
                        <p class="p12">{{'leadDetails.CSRBuyer' | translate}}</p>
                    </div>
                </li>
                <li>
                    <div class="df-info" *ngIf="leadData?.broker">
                        <p class="p14 marginB0">{{leadData.broker.name | titlecase}}</p>
                        <p class="p12">{{leadData?.broker?.is_external_agent==1 ? ('leadDetails.outsideAgent' | translate) : ('leadDetails.inhouseAgent' | translate)}}</p>
                    </div>
                </li>
                <li>
                    <div class="df-info" *ngIf="leadData?.closer">
                        <p class="p14 marginB0">{{leadData.closer.name | titlecase}}</p>
                        <p class="p12">{{'leadDetails.CSRClosure' | translate}}</p>
                    </div>
                </li>
            </ul>
            </div>
        </div>
        <div class="col-lg-2 col-md-12 col-sm-12 col-12">
            <div class="row">
                <div class="col-sm-12 btn-cont text-right">
                    <a *ngIf="leadData?.lead_status_closer!=1 &&
                    (admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1)" (click)="markLeadClose()" class="btn btn-fourth" href="javascript://">
                    {{'leadDetails.closeLead' | translate}}
                    </a>
                    <a *ngIf="leadData?.lead_status_closer==1" style="cursor: auto;" class="btn btn-fourth" href="javascript://">
                    {{'leadDetails.leadClosed' | translate}}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="spacer30"></div>
<div class="row">
    <div class="col-lg-6 col-md-12 col-sm-12 col-12">
        <div class="white-bg padding30">
            <div class="row">
            <div class="col-md-6">
                <h6>{{'leadDetails.details' | translate}}</h6>
            </div>
            <!-- <div class="col-md-6">
                <div class="edit text-right"><a href="javascript://">Edit</a></div>
            </div> -->
            </div>
            <div class="details-table">
            <table class="table">
                <tr>
                    <td style="padding-left:0"><label>{{'leadDetails.fullName' | translate}}</label></td>
                    <td colspan="2" *ngIf="leadData?.name">{{leadData.user.name | titlecase}}</td>
                </tr>
                <tr>
                    <td style="padding-left:0"><label>{{'leadDetails.contactNumber' | translate}}</label></td>
                    <td colspan="2" *ngIf="leadData?.phone">{{leadData.user.dial_code ? leadData.user.dial_code : constant.dial_code}}-{{leadData.user.phone}}</td>
                </tr>
                <tr>
                    <td style="padding-left:0"><label>{{'leadDetails.emailAddress' | translate}}</label></td>
                    <td colspan="2" *ngIf="leadData?.email">{{leadData.user.email}}</td>
                </tr>
                <tr>
                    <td style="padding-left:0"><label>{{'leadDetails.interestedIn' | translate}}</label></td>
                    <td *ngIf="leadData?.configuration">
                        <span *ngFor="let conf of leadData?.configuration; let ii=index">
                            <app-property-configuration *ngIf="conf" [configuration]="conf"></app-property-configuration>
                            <span *ngIf="ii<leadData?.configuration?.length-1"> | </span><br>
                        </span>
                        <span *ngIf="leadData?.configuration?.length==0">{{'leadDetails.NA' | translate}}</span>
                    </td>
                </tr>
                <tr>
                    <td style="padding-left:0"><label><strong>{{'leadDetails.propertySelected' | translate}}</strong></label></td>
                    <td *ngIf="leadData?.selected_properties?.length!=0">
                        <p class="p14 marginB0">
                            <app-property-configuration *ngIf="leadData?.selected_properties[0]?.property?.configuration" [configuration]="leadData?.selected_properties[0]?.property?.configuration"></app-property-configuration>
                        </p>
                        <p title="{{'table.title.building' | translate}}" class="p12 marginB0"><strong>{{leadData?.selected_properties[0]?.property?.building?.name}}</strong></p>
                        <p title="{{'table.title.developer' | translate}}" class="p11"><i>{{leadData?.selected_properties[0]?.property?.building?.developer?.name | titlecase}}</i></p>
                        <p class="marginB0" *ngIf="leadData?.selected_properties?.length!=0">
                            <a class="view-all-2" href="javascript://" (click)="viewPropertyDetails(leadData?.selected_properties[0])"> {{'leadDetails.viewProperty' | translate}}</a>
                        </p>
                    </td>
                    <!-- <td *ngIf="leadData?.selected_properties?.length!=0">
                        <a class="view-all-2" href="javascript://" (click)="viewPropertyDetails(leadData?.selected_properties[0])"> View Property</a>
                    </td> -->
                </tr>
                
                <!-- Notary Availabilities -->
                <tr *ngIf="leadData?.sale_rent==1">
                    <td  style="padding-left:0"><label><strong>{{'leadDetails.notaryAvailabilities' | translate}}</strong></label></td>
                    <td colspan="2" *ngIf="leadData?.selected_properties[0]?.selected_noatary && leadData?.selected_properties[0]?.selected_noatary[0]?.noatary_availability?.length!=0; else noAvailability3">
                        <p *ngFor="let na of leadData?.selected_properties[0]?.selected_noatary[0]?.noatary_availability; let m=index" class="date">
                            <span *ngIf="m<2">{{na.date_time | moment}}</span>
                        </p>
                        <span class="read-more" *ngIf="leadData?.selected_properties[0]?.selected_noatary[0]?.noatary_availability.length>2" data-toggle="modal" data-target="#get-availability1">Read more</span>
                    </td>
                    <ng-template #noAvailability3>
                        <td colspan="2"><p>{{'leadDetails.noAvailabilityGivenbyNotaryYet' | translate}}</p></td>
                    </ng-template>
                </tr>

                <!-- Meeting Schedule -->
                <tr *ngIf="leadData?.sale_rent==1">
                    <td  style="padding-left:0"><label><strong>{{'leadDetails.meetingSchedule' | translate}}</strong></label></td>
                    <td colspan="2" class="cursor-pointer">
                        <p class="date" *ngIf="scheduleMeeting.appointment_date; else noAvailability4" data-toggle="modal" data-target="#get-availability2">
                            <span title="{{'table.title.rescheduleMeeting' | translate}}">{{scheduleMeeting.appointment_date | moment}}</span>
                        </p>
                        <ng-template #noAvailability4>
                            <p title="{{'table.title.scheduleMeeting' | translate}}" data-toggle="modal" data-target="#get-availability2">{{'leadDetails.meetingNotSchedule' | translate}}</p>
                        </ng-template>
                    </td>
                </tr>

            </table>
            </div>
        </div>

        <!-- notes start -->
        <app-notes *ngIf="parameter?.lead_id" [sent_as]="parameter.sent_as" [lead_id]="parameter.lead_id"></app-notes>
        <!-- notes end -->

        <!-- <div class="spacer15"></div> -->
        <div *ngIf="leadData?.sale_rent==1" class="bank-assigned-now white-bg">
            <div class="row">
                <div class="col-md-6 col-sm-6 col-12 b-left">
                <p class="p13" *ngIf="selectedProperties?.noataries && selectedProperties.noataries.length==0">{{'leadDetails.noNotaryAssigned' | translate}}</p>
                
                <!-- Assign notary -->
                <a style="display:none;" #showNotaries href="javascript://" class="green green-color" data-toggle="modal" data-target="#notary-avail">{{'leadDetails.assignNow' | translate}}</a>
                <a *ngIf="selectedProperties?.noataries && selectedProperties.noataries.length==0 && (admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1); else noNotaryPermission"
                    href="javascript://" class="green-color green" (click)="getNotaries(selectedProperties.property_id, '', 1)">{{'leadDetails.assignNow' | translate}}</a>
                
                <ng-template *ngIf="selectedProperties?.noataries && selectedProperties.noataries.length==0" #noNotaryPermission>
                    <a class="green-color green">{{'leadDetails.assignNow' | translate}}</a>
                </ng-template>

                <div class="d-flex" *ngIf="selectedProperties?.noataries && selectedProperties.noataries.length!=0">
                    
                    <!-- <img [src]="selectedProperties?.noataries && selectedProperties.noataries[0].image" onerror='src="assets/img/house.png"' alt="img"> -->

                    <img *ngIf="selectedProperties.noataries[0].image" onerror='src="assets/img/house.png"' alt="img"
                            [defaultImage]="selectedProperties.noataries[0].image| img:'thumb'" [lazyLoad]="selectedProperties.noataries[0].image">
                    <img *ngIf="!selectedProperties.noataries[0].image" src="assets/img/house.png" alt="img">
                    
                    <div class="bank-info">
                        <p title="{{'table.title.notary' | translate}}" class="p14">{{selectedProperties.noataries[0].name | titlecase}}</p>
                        <p class="p11 marginB10">{{selectedProperties.noataries[0].dial_code ? selectedProperties.noataries[0].dial_code : constant.dial_code}}-{{selectedProperties.noataries[0].phone}}</p>
                        
                        <!-- change notary -->
                        <a href="javascript://" #showNotaries style="display: none;" data-toggle="modal" data-target="#notary-avail" class="green-color green">{{'leadDetails.change' | translate}}</a>
                        <a *ngIf="(admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1); else noNotaryChangePermission" href="javascript://" class="green-color green" (click)="getNotaries(selectedProperties.property_id, '', 1)">Change</a>
                        <ng-template #noNotaryChangePermission>
                            <a href="javascript://" class="green-color green">{{'leadDetails.change' | translate}}</a>
                        </ng-template>
                    </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-6 col-12 b-right">
                <p class="p13" *ngIf="selectedProperties?.banks && selectedProperties.banks.length==0">{{'leadDetails.noBankAssigned' | translate}}</p>
                
                <!-- Assign bank -->
                <a style="display:none;" #showBanks href="javascript://" class="green green-color" data-toggle="modal" data-target="#bank-listing">{{'leadDetails.assignNow' | translate}}</a>
                <a *ngIf="selectedProperties?.banks && selectedProperties.banks.length==0 && (admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1); else noBankPermission"
                href="javascript://" class="green-color green" (click)="getBanks(selectedProperties.property_id, '', 1)">{{'leadDetails.assignNow' | translate}}</a>
                
                <ng-template *ngIf="selectedProperties?.banks && selectedProperties.banks.length==0" #noBankPermission>
                    <a href="javascript://" class="green-color green">{{'leadDetails.assignNow' | translate}}</a>
                </ng-template>

                <div class="d-flex" *ngIf="selectedProperties?.banks && selectedProperties.banks.length!=0">
                    
                    <!-- <img [src]="selectedProperties?.banks && selectedProperties.banks[0].image" onerror='src="assets/img/bank-building.png"' alt="img"> -->

                    <img *ngIf="selectedProperties.banks[0].image" onerror='src="assets/img/house.png"' alt="img"
                            [defaultImage]="selectedProperties.banks[0].image| img:'thumb'" [lazyLoad]="selectedProperties.banks[0].image">
                    <img *ngIf="!selectedProperties.banks[0].image" src="assets/img/house.png" alt="img">

                    <div class="bank-info">
                        <p title="{{'table.title.bank' | translate}}" class="p14">{{selectedProperties.banks[0].name | titlecase}}</p>
                        <p class="p11 marginB10">{{selectedProperties?.banks[0]?.branch ? selectedProperties?.banks[0]?.branch : ('leadDetails.NA' | translate)}}</p>
                        
                        <!-- change bank -->
                        <a href="javascript://" #showBanks style="display: none;" data-toggle="modal" data-target="#bank-listing" class="green-color green">{{'leadDetails.change' | translate}}</a>
                        <a *ngIf="(admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1); else noBankChangePermission" href="javascript://" class="green-color green" (click)="getBanks(selectedProperties.property_id, '', 1)">{{'leadDetails.change' | translate}}</a>
                        <ng-template #noBankChangePermission>
                            <a href="javascript://" class="green-color green">{{'leadDetails.change' | translate}}</a>
                        </ng-template>
                    </div>
                </div>
                </div>
            </div>
        </div>

        <!-- <div class="spacer15"></div> -->
        <!-- *ngIf="leadData?.sale_rent==1" -->
        <div class="payment-status-table white-bg">
            <div class="page-title-2 marginB0 border-0">
                <div class="row">
                <div class="col-md-6 col-sm-6 col-12">
                    <h4>{{'leadDetails.paymentStatus' | translate}}</h4>
                </div>
                    <div class="col-md-6 col-sm-6 col-12">
                    <div class="grand-total">${{selectedProperties.total_amount}}</div>
                </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                <table class="table">
                    <tr>
                        <td style="width:40%"><label>{{'leadDetails.tokenAmount' | translate}}</label></td>
                        <td style="width:40%"><strong>${{selectedProperties.token_money}}</strong></td>
                        <td class="text-right" style="width:20%">
                            <div class="pending-status">{{selectedProperties.status==1 ? ('leadDetails.paid' | translate) : ('leadDetails.pending' | translate)}}</div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:40%"><label>{{'leadDetails.commissionInPerc' | translate}}</label></td>
                        <td style="width:40%"><strong>{{selectedProperties.commision}}%</strong></td>
                        <td style="width:20%">&nbsp;</td>
                    </tr>
                    <tr>
                        <td style="width:40%">
                            <label>{{'leadDetails.pendingAmount' | translate}}</label>
                            <small>({{'leadDetails.fullProperty' | translate}})</small>
                        </td>
                        <td style="width:40%">
                            <strong *ngIf="!showInput && selectedProperties.pending_amount==null">${{selectedProperties.total_amount - selectedProperties.token_money}}</strong>
                            <strong *ngIf="!showInput && selectedProperties.pending_amount!=null">${{selectedProperties.pending_amount}}</strong>
                            <input style="width: 90%;" [(ngModel)]="pen_amount" *ngIf="showInput" type="number" value="{{selectedProperties.total_amount - selectedProperties.token_money}}">
                        </td>
                        <td style="width:20%">
                            <a *ngIf="!showInput" title="{{'table.title.editAmount' | translate}}" (click)="showInput=true" class="green-color fontW500" href="javascript://">{{'leadDetails.edit' | translate}}</a>
                            <a *ngIf="showInput" title="{{'table.title.saveAmount' | translate}}" (click)="updatePropertyAmount()" class="green-color fontW500" href="javascript://">{{'leadDetails.save' | translate}}</a>
                            <!-- <button *ngIf="!showInput" title="Edit Amount" (click)="showInput=true">
                                <img src="assets/img/edit.png" alt="img">
                            </button>
                            <button *ngIf="showInput" (click)="updatePropertyAmount()">Save</button> -->
                        </td>
                    </tr>
                </table>
                </div>
            </div>

        </div>
    </div>



    <!-- chatting -->
    <div class="col-lg-6 col-md-12 col-sm-12 col-12">
        <!-- <div class="white-bg move-below">
            <div class="page-title-3 marginB0">
                <h4><i><img src="assets/img/chat-icon.png" alt="img"></i> Chat</h4>
            </div>
            <div class="cust-tabs-4">
                <app-chat-tabs *ngIf="leadData?.user" [lead_id]="parameter.lead_id" [sent_as]="parameter.sent_as"
                    [user_id]="parameter.user_id" [admin_id]="parameter.admin_id" [leadData]="leadData">
                </app-chat-tabs>
            </div>
        </div> -->
        
        <div class="white-bg move-below">
            <div class="page-title-3 marginB0">
                <h4><i><img src="assets/img/chat-icon.png" alt="img"></i> {{'leadDetails.chat' | translate}}</h4>
            </div>
            <div class="cust-tabs-4">
                <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a [ngClass]="{'active':chat_admin_sent_as==constant.userType.user_buyer}" (click)="getLeadConversation(constant.userType.user_buyer, true)" class="nav-link">{{'leadDetails.buyer' | translate}}</a>
                </li>
                <li class="nav-item">
                    <a [ngClass]="{'active':chat_admin_sent_as==constant.userType.user_seller_dev}" (click)="getLeadConversation(constant.userType.user_seller_dev, true)" class="nav-link">{{'leadDetails.seller' | translate}}</a>
                </li>
                <li class="nav-item" *ngIf="selectedProperties.noataries && selectedProperties.noataries.length!=0 && leadData?.sale_rent==1">
                    <a [ngClass]="{'active':chat_admin_sent_as==constant.userType.notary}" (click)="getLeadConversation(constant.userType.notary, true)" class="nav-link">{{'leadDetails.notary' | translate}}</a>
                </li>
                <li class="nav-item" *ngIf="selectedProperties.banks && selectedProperties.banks.length!=0 && leadData?.sale_rent==1">
                    <a [ngClass]="{'active':chat_admin_sent_as==constant.userType.bank}" (click)="getLeadConversation(constant.userType.bank, true)" class="nav-link">{{'leadDetails.bank' | translate}}</a>
                </li>
                </ul>
                
                <div class="tab-content">
                    <div class="chat-window white-bg">
                    <div class="chat-top">
                        <a href="javascript://">
                        <div class="profile">
                            <div class="fig-block">
                            
                            <!-- <img [src]="chat_admin?.image" onerror="this.src='assets/img/default_img.png'" alt="img" /> -->
                            <img *ngIf="chat_admin?.image" onerror='src="assets/img/default_img.png"' alt="img"
                                    [defaultImage]="chat_admin?.image| img:'thumb'" [lazyLoad]="chat_admin?.image">
                            <img *ngIf="!chat_admin?.image" src="assets/img/default_img.png" alt="img">
                            
                            </div>
                            <div class="profile-info">
                            <h6>{{chat_admin?.name | titlecase}}</h6>
                            <p *ngIf="chat_admin_sent_as == 3" class="p12">{{'leadDetails.CSRClosure' | translate}}</p>
                            <p *ngIf="chat_admin_sent_as == 6" class="p12">{{'leadDetails.notary' | translate}}</p>
                            <p *ngIf="chat_admin_sent_as == 5" class="p12">{{'leadDetails.bank' | translate}}</p>
                            </div>
                        </div>
                        </a>
                    </div>
                    <div malihu-scrollbar [scrollbarOptions]="scrollbarOptions" class="chat-area scrollbox" #chatWin>
                        <div *ngFor="let m of messages; let i=index" [ngClass]="m.conversation_user.admin_id == parameter.admin_id ? 'chat-user-one' :'chat-user-two'" class="chat-user">
                            <p *ngIf="m.message_type == 1" style="word-wrap: break-word;">
                                <span>{{m.message}}</span>
                            </p>

                            <a *ngIf="m.message_type == 2" href="{{m.image}}" data-lightbox="image">
                                <span *ngIf="!m.loading">
                                    <img class="ui bordered small image" src="{{m.image}}">
                                </span>
                                <span *ngIf="m.loading" class="m-loader">
                                    <img src="assets/img/loading_image_1.gif">
                                </span>
                            </a>
                            
                            <div class="chat-vid" *ngIf="m.message_type == 3 && !m.play">
                                <span>
                                    <div *ngIf="m.loading" class="loaderr"></div>
                                    <img *ngIf="m.image" class="ui bordered small image" src="{{m.image}}">
                                    <img *ngIf="!m.loading" class="vid-icon" (click)="playVideo(i)" src="assets/img/play-button.png" />
                                    <div class="clearfix"></div>
                                </span>
                            </div>
                            <video *ngIf="m.message_type == 3 && m.play" src="{{m.video}}" autoplay type="video/mp4" controls></video>
                            
                            <div class="chat-shared-file" *ngIf="m.message_type == 4">
                                <p *ngIf="m.loading" class="m-loader">
                                    <img class="text-message" src="assets/img/loading-p.gif">
                                </p>
                                <span *ngIf="!m.loading">
                                    <a href="javascript://" target="_blank" href="{{m.attachment}}"><span>{{m.attachment_name}}</span></a>
                                </span>
                            </div>

                            <a *ngIf="m.message_type == 5" href="{{m.property_url}}" target="_blank" title="{{'table.title.propertyImage' | translate}}" >
                                <span>
                                    <img class="ui bordered small image" src="{{m.image}}">
                                    <div *ngIf="m.loading" class="loaderr"></div>
                                </span>
                                <h5>{{m.message}}</h5>
                            </a>
            
                            <span class="time" *ngIf="m.id">{{m.updated_at| moment}}</span>
                            <span class="time" *ngIf="!m.id">{{m.updated_at|date:'h:mm a'|lowercase}}, {{m.updated_at|date: 'MMM d y'}}</span>
                            
                        </div>                
                    </div>
                                            
                    <div style="position: absolute; z-index: 1; margin: 0px; padding: 0px; other: block; left: 581px; top: 91px;"><div class="enscroll-track track3" style="position: relative; height: 367px;"><a href="" class="handle3" style="position: absolute; z-index: 1; height: 199.244px; top: 0px;"><div class="top"></div><div class="bottom"></div></a></div></div>
    
                    <div class="chat-text">
                        <div class="dropdown attach-items">
                            <a *ngIf="(admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1); else noPermissiom" href="javascript://" class="dropdown-toggle" data-toggle="dropdown" #optionsButton>
                                <i class="fa fa-paperclip" aria-hidden="true"></i>
                            </a>

                            <ng-template #noPermissiom>
                                <a><i class="fa fa-paperclip" aria-hidden="true"></i></a>
                            </ng-template>
                            <div class="dropdown-menu">
                            <div class="dropdown-item">
                                <input type="file" name="image" accept="image/*" (change)="onSelectFile('image', $event)">
                                <i class="fa fa-camera" aria-hidden="true"></i>
                                <span>{{'leadDetails.photo' | translate}}</span>
                            </div>
                            <a class="dropdown-item"> 
                                <input type="file" name="video1" accept="video/mp4,video/x-m4v,video/*" (change)="showCanvas($event)">
                                <i class="fa fa-video-camera" aria-hidden="true"></i>
                                <span>{{'leadDetails.video' | translate}}</span>
                            </a>
                            <a class="dropdown-item">    
                                <input type="file" name="attachment" accept=".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf" (change)="saveAttachment($event)">
                                <i class="fa fa-file" aria-hidden="true"></i>
                                <span>{{'leadDetails.document' | translate}}</span>
                            </a>
                            <a class="dropdown-item cursor-pointer" (click)="blockGetProperty.showModal()">    
                                <i class="fa fa-file" aria-hidden="true"></i>
                                <span>{{'leadDetails.property' | translate}}</span>
                            </a>
                            </div>
                        </div>
                        <input id="message" #msgInput autocomplete="off" [(ngModel)]="textMessage" (keyup.enter)="setText()" class="chat-input" type="text" name="message" placeholder="Type your message here …">
                        <video style="width: 100%; height: 100%;" src="{{videoSrc}}" class="video55" autoplay type="video/mp4" controls></video>
                        <canvas style="display: none;" width="800" height="600" id="canvas"></canvas>
    
                        <button [disabled]="(admin?.admin_acl['Closer Lead Management']?.can_update==0 || admin?.permissions?.can_csr_closer==0)" (click)="setText()" class="btn">{{'leadDetails.send' | translate}}</button>
                        
                    </div>
                </div>
    
            </div>
        </div>
    </div>


<app-block-get-property #blockGetProperty (itemSelect)="sendProperty($event)"></app-block-get-property>


    <div class="clearfix"></div>
    <div *ngIf="leadData?.sale_rent==1" class="upload-document-block white-bg">
        <div class="page-title-2 border-0">
            <div class="row">
                <div class="col-9">
                <h4>{{'leadDetails.documents' | translate}}</h4>
                </div>
                <div class="col-3">
                <a *ngIf="(admin?.admin_acl['Closer Lead Management']?.can_update==1 || admin?.permissions?.can_csr_closer==1); else noDocumentPermission" class="view pull-right" href="javascript://" (click)="updateDocumentChecklist()">Save</a>
                <ng-template #noDocumentPermission>
                    <a class="view pull-right" href="javascript://">{{'leadDetails.save' | translate}}</a>
                </ng-template>
                </div>
            </div>
            <table class="table">
                <tr *ngFor="let document of selectedProperties.allDocuments; let i=index">
                <td>
                    <label class="cust-check-bx">{{document.name}}
                    <input type="checkbox" (click)="setValue(i)" [checked]="document.is_selected == 1 ? 'checked' : ''" name="document">
                    <span class="checkmark"></span>
                    </label>
                </td>
                </tr>
            </table>
        </div>
    </div>
    <div *ngIf="leadData?.sale_rent==1" class="all-document-block white-bg">
        <div class="page-title-2 border-0">
        <div class="row">
        <div class="col-9">
            <h4>{{'leadDetails.save' | translate}}</h4>
            <p class="p11 marginB0">{{'leadDetails.fromBothSellerAndBuyer' | translate}}</p>

            </div>
            <div class="col-3 text-right">
                <a *ngIf="selectedProperties?.uploaded_documents?.length==0" (click)="noDocumentUploaded()" class="view" href="javascript://" >{{'leadDetails.view' | translate}}</a>
                <a *ngIf="selectedProperties?.uploaded_documents?.length!=0" class="view" data-toggle="modal" data-target="#uploaded-documents" href="javascript://" >{{'leadDetails.view' | translate}}</a>
            </div>
        </div>
        </div>
    </div>
    </div>
</div>
</div>


<div class="modal" id="uploaded-documents">
    <div class="modal-dialog ">
    <div class="modal-content notary-avail">
        <!-- <div class="modal-header modal-header-new"> -->
            <div class="modal-header modal-header-new">
            <h4 class="modal-title">{{'leadDetails.uploadedDocuments' | translate}}</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
            <table class="table">
                <tr *ngFor="let upDocument of selectedProperties.uploaded_documents">
                <td>
                    <div class="n-avail-profile">
                        <div class="n-avail-info">
                            <p class="p14 marginB0" *ngIf="upDocument.attachment_name">{{upDocument.attachment_name}}</p>
                            <!-- <p class="p12" *ngIf="!upDocument.attachment_name">{{upDocument.attachment.substring(upDocument.attachment.lastIndexOf('/'), upDocument.attachment.length)}}</p> -->
                            <p class="p14 marginB0" *ngIf="!upDocument.attachment_name">{{'leadDetails.noName' | translate}}</p>
                        </div>
                    </div>
                </td>
                <td class="text-right">
                    <a class="green-color" target="_blank" href="{{upDocument.attachment}}">{{'leadDetails.download' | translate}}</a>
                </td>
                </tr>
            </table>
        </div>
    </div>
    </div>
</div>

<div class="modal" id="bank-listing">
    <div class="modal-dialog ">
    <div class="modal-content notary-avail">
        <div class="modal-header popup-header">
            <h4 class="modal-title">{{'leadDetails.banksAvailable' | translate}}</h4>
            <button type="button" class="close" data-dismiss="modal" #hideBanks>&times;</button>
        </div>
        <div class="modal-body">

            <div class="spacer30"></div>
            <div class="row">
                <div class="col-md-8 col-6">
                    <input style="max-width:200px" (keyup.enter)="getBanks('', keyword, 2)" [(ngModel)]="keyword" class="form-control" type="text" name="keyword" placeholder="Search">
                </div>
                <div class="col-md-4 col-5 btn-cont">
                    <a class="btn btn-primary pull-right" href="javascript://" (click)="getBanks('', keyword, 2)">{{'leadDetails.search' | translate}}</a>
                </div>
            </div>
            <div class="spacer30"></div>
            <div class="modal-data">
                <table class="table">
                    <tr *ngFor="let bank of parameter.banks">
                    <td>
                        <div class="n-avail-profile">
                            <!-- <img [src]="bank.image" onerror='src="assets/img/bank.png"' alt="img"> -->
                            
                            <img *ngIf="bank.image" onerror='src="assets/img/bank.png"' alt="img"
                                    [defaultImage]="bank.image| img:'thumb'" [lazyLoad]="bank.image">
                            <img *ngIf="!bank.image" src="assets/img/bank.png" alt="img">

                            <div class="n-avail-info">
                                <p class="p12">{{bank.name | titlecase}}</p>
                                <p class="p10">{{'leadDetails.branch' | translate}} : {{bank.branch ? bank.branch : ('leadDetails.NA' | translate)}}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <label class="cust-check-bx float-right">
                        <input type="radio" name="bank_id" (click)="assignBank(bank)">
                        <span class="checkmark"></span>
                        </label>
                    </td>
                    </tr>
                    <div  *ngIf="parameter.banks?.length==0" class="write-note white-bg">
                        <p class="show-not-found">
                            {{'leadDetails.noBankAvailable' | translate}}
                        </p>
                    </div>
                </table>
            </div>
        </div>
    </div>
    </div>
</div>

<div class="modal" id="notary-avail">
    <div class="modal-dialog ">
        <div class="modal-content notary-avail">
            <div class="modal-header popup-header">
            <h4 class="modal-title">Notaries available</h4>
            <button type="button" class="close" data-dismiss="modal" #hideNotaries>&times;</button>
            </div>
            <div class="modal-body">
                
               <div class="spacer30"></div>
                <div class="row">
                    <div class="col-md-8 col-6">
                        <input style="max-width:200px" (keyup.enter)="getNotaries('', keyword, 2)" [(ngModel)]="keyword" class="form-control" type="text" name="keyword" placeholder="Search">
                    </div>
                    <div class="col-md-4 col-5 btn-cont">
                        <a class="btn btn-primary pull-right" href="javascript://" (click)="getNotaries('', keyword, 2)">Search</a>
                    </div>
                </div>
                <div class="spacer30"></div>
                <div class="modal-data">
                    <table class="table">
                        <tr *ngFor="let item of parameter.items">
                            <td>
                                <div class="n-avail-profile">
                                <!-- <img [src]="item.image" onerror='src="assets/img/house.png"' alt="img"> -->
                                
                                <img *ngIf="item.image" onerror='src="assets/img/house.png"' alt="img"
                                    [defaultImage]="item.image| img:'thumb'" [lazyLoad]="item.image">
                                <img *ngIf="!item.image" src="assets/img/house.png" alt="img">
                                
                                <div class="n-avail-info">
                                    <p class="p12">{{item.name | titlecase}}</p>
                                    <p class="p10">Phone : {{item.dial_code ? item.dial_code : constant.dial_code}}-{{item.phone}}</p>
                                </div>
                                </div>
                            </td>
                            <td>
                                <label class="cust-check-bx float-right">
                                    <input type="radio" name="notary_id" (click)="assignNoatary(item)">
                                    <span class="checkmark"></span>
                                </label>
                            </td>
                        </tr>
                        <div  *ngIf="parameter?.items?.length==0" class="write-note white-bg">
                            <p class="show-not-found">
                                No notary is available.
                            </p>
                        </div>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal animated" id="get-availability1">
    <div class="modal-dialog fadeIndown">
        <div class="modal-content">
            <div class="modal-header modal-header-new">
                <h4 class="modal-title">Notary Availabilities</h4>
                <button type="button" style="display: none;" class="close" data-dismiss="modal" #modalClose1>&times;</button>
                <button type="button" class="close" (click)="closeModal1()">&times;</button>
            </div>
    
            <div class="modal-body modal-body-new">
                <div class="row" *ngIf="leadData?.selected_properties && leadData?.selected_properties[0]?.selected_noatary">
                    <div class="col-6" *ngFor="let d of leadData?.selected_properties[0]?.selected_noatary[0]?.noatary_availability; let j=index">
                        <label class="notary-ava">{{d.date_time | moment}}</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal animated" id="get-availability2">
    <div class="modal-dialog fadeIndown">
        <div class="modal-content">
            <div class="modal-header modal-header-new">
                <h4 class="modal-title">Schedule Meeting</h4>
                <button type="button" style="display: none;" class="close" data-dismiss="modal" #modalClose2>&times;</button>
                <button type="button" class="close" (click)="closeModal2()">&times;</button>
            </div>
    
            <div class="modal-body modal-body-new">
                <table class="table" *ngIf="leadData?.selected_properties[0]?.selected_noatary">
                    <tr *ngFor="let d of leadData?.selected_properties[0]?.selected_noatary[0]?.noatary_availability; let j=index">
                        <td>
                            <label class="notary-ava">{{d.date_time | moment}}</label>
                        </td>
                        <td>
                            <label class="cust-check-bx float-right">
                                <input [checked]="d.date_time==scheduleMeeting.appointment_date" type="radio" name="notary_id" (click)="addAppointment(d)">
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <div *ngIf="leadData?.selected_properties[0]?.selected_noatary[0]?.noatary_availability==null" class="write-note white-bg">
                        <p class="show-not-found">
                            No availability given by notary yet.
                        </p>
                    </div>
                </table>
            </div>
    
        </div>
    </div>
</div>