<div class="container-fluid">
  <div class="row">
    <div class="col-lg-6 col-md-6 col-sm-6 col-12">
      <div class="form-group">
        <p class="p16">{{'sidebar.propertiesSold' | translate}}</p>
      </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-6 col-12">
      <div class="form-group" style="float: right;">
        <button class="action-icon" (click)="getPropertySelection(true)"
          title="{{'table.title.selectColumns' | translate}}"><i class="fa fa-pause"
            style="cursor: pointer;"></i></button>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-2 col-md-2">
      <div class="form-group">
        <label>{{'filters.location.country' | translate}}</label>
        <select class="form-control" (change)="onCountryChange($event.target.value)" [(ngModel)]="parameter.country_id"
          style="background-color: white;">
          <option value="0">{{'filters.location.allOption' | translate}}</option>
          <option *ngFor="let item of location.countries" [value]="item.id">{{item.name}}</option>
        </select>
      </div>
    </div>
    <div class="col-lg-2 col-md-2">
      <div class="form-group">
        <label>{{'filters.location.state' | translate}}</label>
        <select class="form-control" (change)="onStateChange($event.target.value)" [(ngModel)]="parameter.state_id"
          style="background-color: white;">
          <option value="0">{{'filters.location.allOption' | translate}}</option>
          <option *ngFor="let item of location.states" [value]="item.id">{{item.name}}</option>
        </select>
      </div>
    </div>


    <div class="col-lg-2 col-md-2">
      <div class="form-group">
        <label>{{'filters.location.city' | translate}}</label>
        <ng-multiselect-dropdown class="col-3 section-section2 multi-select" [placeholder]="''" name="selectedCities"
          [data]="location.cities" [(ngModel)]="selectedLocation.selectedCities"
          [settings]="multiDropdownSettingsForLocation" (onDeSelect)="onCityChange()" (onSelect)="onCityChange()"
          (onSelectAll)="onCityChangeAll($event)" (onDeSelectAll)="onCityChangeAll($event)">
        </ng-multiselect-dropdown>
      </div>
    </div>

    <div class="col-lg-2 col-md-2" *ngIf="all != 1">
      <div class="form-group">
        <label>{{'filters.location.locality' | translate}}</label>
        <ng-multiselect-dropdown class="col-3 section-section2 multi-select" [placeholder]="''"
          name="selectedLocalities" [data]="location.localities" [(ngModel)]="selectedLocation.selectedLocalities"
          [settings]="multiDropdownSettingsForLocation" (onDeSelect)="onLocalityChange()"
          (onSelect)="onLocalityChange()" (onSelectAll)="onLocalityChangeAll($event)"
          (onDeSelectAll)="onLocalityChangeAll($event)">
        </ng-multiselect-dropdown>
      </div>
    </div>

    <div class="col-lg-2 col-md-2" *ngIf="all == 1">
      <div class="form-group">
        <label>{{'filters.location.locality' | translate}}</label>
        <ng-multiselect-dropdown class="col-3 section-section2 multi-select" [placeholder]="''"
          name="selectedLocalities" [data]="location.localities" [(ngModel)]="selectedLocation.selectedLocalities"
          [settings]="multiDropdownSettingsForLocation" (onDeSelect)="onLocalityChange()"
          (onSelect)="onLocalityChange()" (onSelectAll)="onLocalityChangeAll($event)"
          (onDeSelectAll)="onLocalityChangeAll($event)">
        </ng-multiselect-dropdown>
      </div>
    </div>

    <div class="col-lg-2 col-md-2">
      <div class="form-group marginB0">
        <label>{{'filters.location.building' | translate}}</label>
        <select class="form-control" (change)="setBuilding($event.target.value)" [(ngModel)]="parameter.building_id"
          style="background-color: white;">
          <option value="0">{{'filters.location.allOption' | translate}}</option>
          <option *ngFor="let building of parameter.buildings" value="{{building.id}}">{{building.name}}</option>
        </select>
      </div>
    </div>

    <div class="col-lg-1 col-md-2">
      <div class="form-group btn-cont">
        <label style="display: block; margin-top: 3px;">&nbsp;</label>
        <button type="button" (click)="getListing('','')"
          class="btn btn-primary-new width100P P86">{{'filters.location.applyBtn' | translate}}</button>
      </div>
    </div>

    <div class="col-lg-1 col-md-2">
      <div class="form-group btn-cont">
        <label style="display: block; margin-top: 3px;">&nbsp;</label>
        <button type="button" (click)="resetFilters()"
          class="btn btn-primary-new width100P P86">{{'filters.location.resetBtn' | translate}}</button>
      </div>
    </div>
  </div>


  <div class="cust-tabs">
    <div class="row flex-wrap-reverse">
      <div class="col-xl-2 col-lg-12 col-md-12 col-sm-12 col-12">
        <div class="add-new text-left">
          <a class="btn" #modalOpen data-toggle="modal" data-target="#advancedSearch"
            routerLink="/dashboard/properties/add-bulk-property/0/0">
            {{'advanceSearch.advancedSearch' | translate}}</a>
        </div>
      </div>
      <div class="col-xl-2 col-lg-12 col-md-12 col-sm-12 col-12">
        <div class="add-new text-left"  *ngIf="all != 1">
          <a class="btn" (click)="getExportlisting()" href="javascript://">
            {{'table.exportDataBtn' | translate}}</a>
        </div>
      </div>

    </div>
    <div class="tab-content white-bg">
      <div class="tab-pane active">
        <div class="tabel-section">
          <div class="table-responsive">
            <table class="table table-striped table-align-left">
              <tr>
                <th style="width:10%; text-align:left;" *ngIf="selectedPropertyColumnsToShow?.building_name">
                  <div class="table-search">
                    <label>{{'table.th.nameOfBuilding' | translate}}</label>
                    <div class="searh-3">
                      <input class="width100px" type="text" [(ngModel)]="parameter.building_name" name="building_name"
                        (keyup.enter)="getListing('','')" autocomplete="address-level4">
                      <button *ngIf="parameter.building_name" (click)="getListing('','')"><i class="fa fa-search"></i></button>
                    </div>
                  </div>
                </th>
                <th style="width:10%; text-align:left;" *ngIf="selectedPropertyColumnsToShow?.floor">
                  <div class="table-search">
                    <label>{{'table.th.floor' | translate}}</label>
                    <select [(ngModel)]="parameter.floor_num" (change)="getListing('','')" name="floor_num">
                      <option value="">{{'table.th.allFloors' | translate}}</option>
                      <option *ngFor="let c of floors" value="{{c.id}}">
                        {{c.name}}
                      </option>
                    </select>
                  </div>
                </th>
                <th style="width:10%; text-align:left;" *ngIf="selectedPropertyColumnsToShow?.apartament">
                  <div class="table-search">
                    <label>{{'table.th.apartment' | translate}}
                      <a (click)="sort_by(4)" href="javascript://"><img [ngClass]="{'upsidedown':parameter.sort_by==4}"
                          src="assets/img/top-arrow.png" alt="img"></a>
                    </label>
                    <div class="searh-3">
                      <input class="width120px" type="text" [(ngModel)]="parameter.name" name="name"
                        (keyup.enter)="getListing('','')" autocomplete="address-level4">
                      <button *ngIf="parameter.name" (click)="getListing('','')"><i class="fa fa-search"></i></button>
                    </div>
                  </div>
                </th>
                <th style="width:10%; text-align:left;" *ngIf="selectedPropertyColumnsToShow?.model">
                  <div class="table-search">
                    <label>{{'table.th.model' | translate}}</label>
                    <div class="searh-3">
                      <input class="width120px" type="text" [(ngModel)]="parameter.configuration_name"
                        name="configuration_name" (keyup.enter)="getListing('','')" autocomplete="address-level4">
                      <button *ngIf="parameter.configuration_name" (click)="getListing('','')"><i
                          class="fa fa-search"></i></button>
                    </div>
                  </div>
                </th>
                <th style="width:10%; text-align:left;" *ngIf="selectedPropertyColumnsToShow?.configuration">
                  <div class="table-search">
                    <label>{{'table.th.configuration' | translate}}</label>
                    <select [(ngModel)]="parameter.configuration_id" (change)="getListing('','')" name="configuration_id">
                      <option value="0">{{'table.th.allConfiguration' | translate}}</option>
                      <option *ngFor="let c of configurations" value="{{c.id}}">

                        <span *ngIf="c.status">
                          <app-property-configuration *ngIf="c" [configuration]="c">
                          </app-property-configuration>
                        </span>
                      </option>
                    </select>
                  </div>
                </th>
                <th style="width:8%;vertical-align:top;" *ngIf="selectedPropertyColumnsToShow?.stp_key">
                  <div class="d-flex table-search">
                    <label>{{'table.th.back_referencs' | translate}}</label>
                  </div>
                </th>
                <th style="width:8%;vertical-align:top;" *ngIf="selectedPropertyColumnsToShow?.agent">
                  <div class="d-flex table-search">
                    <label>{{'table.th.inhouseagent' | translate}}</label>
                  </div>
                </th>
                <th style="width:8%;vertical-align:top;" *ngIf="selectedPropertyColumnsToShow?.agent">
                  <div class="d-flex table-search">
                    <label>{{'table.th.outsideagent' | translate}}</label>
                  </div>
                </th>
              </tr>

              <tbody *ngIf="is_filter">
                <tr
                  *ngFor="let p of items | paginate: { itemsPerPage: parameter.itemsPerPage, currentPage: parameter.page, totalItems: total }; let i=index">
                  <td class="cursor-pointer" title="{{'table.title.clickToViewDetails' | translate}}"
                  routerLink="/dashboard/projects/details/{{p.building.id}}" *ngIf="selectedPropertyColumnsToShow?.building_name">
                    <strong>{{p?.building?.name || ('table.tr.td.NA' | translate)}}</strong>
                    <div class="clearfix"></div>
                    <small *ngIf="p.quantity > 0">
                      {{p.quantity}}
                      <span *ngIf="p.quantity == 1">property</span>
                      <span *ngIf="p.quantity > 1">properties</span>
                    </small>
                  </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.floor">
                    <span> {{(p?.floor_num == 0 ? ('addCollection.groundFloor' | translate) : ('addCollection.floor'| translate) + ' ' + p?.floor_num)}}</span></td>
                  <td class="cursor-pointer" title="{{'table.title.clickToViewDetails' | translate}}"
                  (click)="viewPropertyDetails(p.id, p)" *ngIf="selectedPropertyColumnsToShow?.apartament">
                  <span>{{p?.name || ('table.tr.td.NA' | translate)}}</span></td>
                  <td *ngIf="selectedPropertyColumnsToShow?.model">
                    <span [style.textAlign]="'center'">
                      <b>{{p?.building_configuration?.name || ('table.tr.td.NA' | translate)}}</b>
                    </span>
                  </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.configuration">
                    <app-property-configuration *ngIf="p?.building_configuration"
                      [configuration]="p.building_configuration.config"></app-property-configuration>
                  </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.stp_key"><span>{{p?.collection?.bank_reference_id || ('table.tr.td.NA' | translate)}}</span></td>
                  <td *ngIf="selectedPropertyColumnsToShow?.agent">
                           <span>
                                 {{p?.external_broker?.id
                                 ? ('table.tr.td.change' | translate) : ('table.tr.td.NA' | translate)}}</span>
                        </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.agent">
                           <span>
                                 {{p?.external_outside_agent?.id
                                 ? ('table.tr.td.change' | translate) : ('table.tr.td.NA' | translate)}}</span>
                        </td>
                </tr>
              </tbody>
              <!-- chache wla data -->
              <tbody *ngIf="!is_filter">
                <tr
                  *ngFor="let p of cs.sold_items | paginate: { itemsPerPage: parameter.itemsPerPage, currentPage: parameter.page, totalItems: cs.sold_total }; let i=index">
                  <td class="cursor-pointer" title="{{'table.title.clickToViewDetails' | translate}}"
                  routerLink="/dashboard/projects/details/{{p.building.id}}" *ngIf="selectedPropertyColumnsToShow?.building_name">
                    <strong>{{p?.building?.name || ('table.tr.td.NA' | translate)}}</strong>
                    <div class="clearfix"></div>
                    <small *ngIf="p.quantity > 0">
                      {{p.quantity}}
                      <span *ngIf="p.quantity == 1">property</span>
                      <span *ngIf="p.quantity > 1">properties</span>
                    </small>
                  </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.floor">
                    <span>{{(p?.floor_num == 0 ? ('addCollection.groundFloor' | translate) : ('addCollection.floor'| translate) + ' ' + p?.floor_num)}}
                    </span>
                  </td>
                  <td class="cursor-pointer" title="{{'table.title.clickToViewDetails' | translate}}"
                  (click)="viewPropertyDetails(p.id, p)" *ngIf="selectedPropertyColumnsToShow?.apartament">
                    <span>
                      {{p?.name || ('table.tr.td.NA' | translate)}}
                    </span>
                  </td>

                  <td *ngIf="selectedPropertyColumnsToShow?.model">
                    <span [style.textAlign]="'center'">
                      <b>{{p?.building_configuration?.name || ('table.tr.td.NA' | translate)}}</b>
                    </span>
                  </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.configuration">
                    <app-property-configuration *ngIf="p?.building_configuration"
                      [configuration]="p.building_configuration.config"></app-property-configuration>
                  </td>
                  <td *ngIf="selectedPropertyColumnsToShow?.stp_key"><span>{{p?.collection?.bank_reference_id || ('table.tr.td.NA' | translate)}}</span></td>
                  <td *ngIf="selectedPropertyColumnsToShow?.agent">
                    <span>
                          {{p?.external_broker?.id
                          ? p.external_broker.name + ' ' + p.external_broker.first_surname + ' ' + p.external_broker.second_surname : ('table.tr.td.NA' | translate)}}</span>
                 </td>
                 <td *ngIf="selectedPropertyColumnsToShow?.agent">
                    <span>
                          {{p?.external_outside_agent?.id
                          ? p.external_outside_agent.name + ' ' + p.external_outside_agent.first_surname + ' ' + p.external_outside_agent.second_surname : ('table.tr.td.NA' | translate)}}</span>
                 </td>
                </tr>
              </tbody>
            </table>
            <div class="padding20 center" *ngIf="cs.sold_total == 0">
              <img src="assets/img/404-error.png">
            </div>
          </div>
        </div>
      </div>
      <div class="tab-pane container fade" id="seller">{{'table.th.sellerTabOn' | translate}}</div>
    </div>
  </div>

  <div class="btn-cont marginT15" *ngIf="!is_filter && cs.sold_items?.length > 1">
    <div class="row">
      <div class="col-6">
        <div class="title-group">
          <p>{{'table.pagination.showing' | translate}} {{cs.sold_items?.length}} {{'table.pagination.outof' | translate}}
            {{cs.sold_ total}}</p>
        </div>
      </div>
      <div class="col-6 text-right">
        <pagination-controls class="my-pagination" (pageChange)="getPage($event)"></pagination-controls>
      </div>
    </div>
  </div>
  <div class="btn-cont marginT15" *ngIf="is_filter && items.length > 1">
    <div class="row">
      <div class="col-6">
        <div class="title-group">
          <p>{{'table.pagination.showing' | translate}} {{items?.length}} {{'table.pagination.outof' | translate}}
            {{total}}</p>
        </div>
      </div>
      <div class="col-6 text-right">
        <pagination-controls class="my-pagination" (pageChange)="getPage($event)"></pagination-controls>
      </div>
    </div>
  </div>
</div>


<div class="modal animated" id="advancedSearch">
  <div class="modal-dialog fadeIndown">
    <div class="modal-content" style="
    border-top-style: solid;
    border-top-width: thick;
    border-top-color: rgb(0, 185, 111); border-radius: 5px;
    box-shadow: 0px -2px 0px 7px rgb(105,105,105);width: 209%;
margin-left: -63%;">
      <div class="modal-header modal-header-new" style="background-color: white;">
        <h4 class="modal-title">{{'advanceSearch.advancedSearch' | translate}}</h4>
        <button style="display: none;" type="button" class="close" data-dismiss="modal" #modalClose>&times;</button>
        <button type="button" class="close" (click)="close()">&times;</button>
      </div>

      <form class="form-horizontal form-model0P form-model-newP">
        <h4 style="color: rgb(48, 46, 46); font-size: 18px;">{{'advanceSearch.priceRange' | translate}}</h4>
        <div class="row">
          <div class="form-group col-md-6">
            <input type="text" class="form-control" placeholder="Min" name="min_price"
              [(ngModel)]="parameter.min_price">
          </div>
          <div class="form-group col-md-6">
            <input type="text" class="form-control" placeholder="Max" name="max_price"
              [(ngModel)]="parameter.max_price">
          </div>
        </div>
        <h4 style="color: rgb(48, 46, 46); font-size: 18px;">{{'advanceSearch.carpetArea' | translate}}</h4>
        <div class="row">
          <div class="form-group col-md-6">
            <input type="text" class="form-control" placeholder="Min" name="min_carpet_area"
              [(ngModel)]="parameter.min_carpet_area">
          </div>
          <div class="form-group col-md-6">
            <input type="text" class="form-control" placeholder="Max" name="max_carpet_area"
              [(ngModel)]="parameter.max_carpet_area">
          </div>
        </div>

        <h4 style="color: rgb(48, 46, 46); font-size: 18px;">{{'advanceSearch.PropertyType' | translate}}</h4>
        <div class="row">
          <div class="form-group col-md-12">
            <label class="cust-radio" *ngFor="let propertyType of propertyTypes">
              <input type="radio" (change)="setValue('property_type_id', propertyType.id)" value="{{propertyType.id}}"
                [(ngModel)]="parameter.property_type_id"
                [checked]="parameter.property_type_id == propertyType.id ? 'checked' : ''" name="property_type_id">
              <span class="checkmark">{{propertyType.name_en}}</span>
            </label>
          </div>
        </div>

        <h4 style="color: rgb(48, 46, 46); font-size: 18px;">{{'advanceSearch.ParkingDetails' | translate}}</h4>
        <div class="row">
          <div class="form-group col-md-4">
            <p class="parking" style="color: #00B96F;">{{'advanceSearch.ParkingAvailable' | translate}}</p>
            <label class="switch">
              <input type="checkbox" [(ngModel)]="parameter.parking" name="parking">
              <span class="slider round"></span>
            </label>
          </div>

          <div class="form-group col-md-4">
            <p class="parking" style="color: #00B96F;">{{'addForm.IsPropertyFurnished' | translate}}</p>
            <label class="switch">
              <input type="checkbox" [(ngModel)]="parameter.furnished" name="furnished">
              <span class="slider round"></span>
            </label>
          </div>

          <div class="form-group col-md-4">
            <p class="parking" style="color: #00B96F;">{{'advanceSearch.ParkingForSale' | translate}}</p>
            <label class="switch">
              <input type="checkbox" [(ngModel)]="parameter.parking_for_sale" name="parking_for_sale" checked>
              <span class="slider round"></span>
            </label>
          </div>

          <div class="form-group col-md-4" *ngIf="parameter.parking == 1">
            {{'generatePDF.parkingPlaces' | translate}}
            <input class="form-control" type="number" [(ngModel)]="parameter.parking_place" min="0"
              name="parking_place">
          </div>

        </div>

        <h4 style="color: rgb(48, 46, 46); font-size: 18px;">{{'advanceSearch.configuration' | translate}}</h4>
        <div class="row">
          <div class="form-group col-md-4">
            {{'advanceSearch.Bedrooms' | translate}}<br />
            <input class="form-control" type="number" [(ngModel)]="parameter.bedroom" min="0" name="bedroom">

          </div>
          <div class="form-group col-md-4">
            {{'advanceSearch.Bathrooms' | translate}}<br />
            <input class="form-control" type="number" [(ngModel)]="parameter.bathroom" min="0" name="bathroom">

          </div>
          <div class="form-group col-md-4">
            {{'advanceSearch.HalfBathrooms' | translate}}<br />
            <input class="form-control" type="number" [(ngModel)]="parameter.half_bathroom" min="0"
              name="half_bathroom">

          </div>
        </div>

        <h4 style="color: rgb(48, 46, 46); font-size: 18px;">{{'propertyDetail.amenities' | translate}}</h4>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="clearfix"></div>
            <ng-multiselect-dropdown class="col-3 section-section2 multi-select" [placeholder]="''"
              name="selctedAmenities" [data]="amenities" [(ngModel)]="selctedAmenities"
              [settings]="multiDropdownSettings" (onDeSelect)="unsetProject($event)"
              (onSelect)="onItemSelect('selctedAmenities', $event)" (onSelectAll)="onSelectAll($event)">
            </ng-multiselect-dropdown>
            <div class="clearfix"></div>

          </div>
        </div>
        <button type="submit" class="btn btn-success" (click)="searchProperties()" style="border-left-color: rgb(0, 185, 111);
              border-right-color: rgb(0, 185, 111);">
         {{'filters.location.applyBtn' | translate}}
        </button>&nbsp;&nbsp;

        <button type="button" class="btn btn-danger" (click)="close()"
          style="background-color: rgb(238, 123, 124);">{{'advanceSearch.cancel' | translate}}</button>

      </form>
    </div>
  </div>
</div>

    <!-- select columns -->
    <a data-toggle="modal" data-target="#link-select-columns-model" #openSelectColumnsModal style="display: none;"></a>
    <div class="modal" id="link-select-columns-model">
      <div class="modal-dialog" style="width: max-content;">
        <div class="modal-content notary-avail">
          <div class="modal-header popup-header">
            <h4 class="modal-title">{{'table.title.columnsSelection' | translate}}</h4>
            <button type="button" class="close" #closeSelectColumnsModal data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <p class="modal-title">{{'table.title.selectTheColumnYouWantToVisualize' | translate}}</p>
            <br />
            <div class="row">
              <div class="col-md-8 col-6">
                <label class="p16-two">
                  <input class="form-control" class="is_commission_sale_enabled" type="checkbox" name="SelectAll"
                    (change)="changeSelectAll()" [(ngModel)]="isSelectAllColumns">
                  <span style="margin-left: 10px; vertical-align: super;">{{'commonBlock.selectAll' |
                        translate}}</span>
                </label>
              </div>
              <div class="col-md-4 col-6 btn-cont">
                <a class="btn btn-primary pull-right" href="javascript://"
                  (click)="applyShowSelectedColumns()">{{'filters.location.applyBtn' | translate}}</a>
              </div>
            </div>
            <div class="spacer40"></div>
            <div class="row">
              <div class="col-md-8 col-6">
                <input style="max-width:200px" (keyup.enter)="getPropertySelection(false, keyword)"
                  [(ngModel)]="keyword" class="form-control" type="text" name="keyword"
                  placeholder="{{'addForm.placeholder.search' | translate}}">
              </div>
              <div class="col-md-4 col-5 btn-cont">
                <a class="btn btn-primary pull-right" href="javascript://"
                  (click)="getPropertySelection(false, keyword)">{{'viewProperty.search' | translate}}</a>
              </div>
            </div>

            <div class="spacer40"></div>
            <div class="modal-table-data" malihu-scrollbar [scrollbarOptions]="scrollbarOptions">
              <table class="table">
                <tr *ngFor="let item of select_columns_list; let ii=index">
                  <td>
                    <div class="row">
                      <div class="col-md-8 col-6">
                        <label class="p16-two">
                          <input class="form-control" class="is_commission_sale_enabled" type="checkbox"
                            name="checkbox{{ii}}" [(ngModel)]="item.isCheckBoxChecked" (change)="changeSelect()">
                          <span style="margin-left: 10px; vertical-align: super;">
                            {{this.language_code == 'en' ? item.name_en : item.name_es }}
                          </span>
                        </label>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
